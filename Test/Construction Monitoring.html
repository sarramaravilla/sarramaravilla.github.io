<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Construction Monitoring</title>
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.24/"></script>

  <script>
    require([
      "esri/Basemap",
      "esri/Map",
      "esri/views/MapView",
      "esri/views/SceneView",
      "esri/layers/FeatureLayer",
      "esri/views/layers/support/FeatureFilter",
      "esri/layers/SceneLayer",
      "esri/layers/Layer",
      "esri/layers/TileLayer",
      "esri/layers/VectorTileLayer",
      "esri/layers/support/LabelClass",
      "esri/symbols/LabelSymbol3D",
      "esri/WebMap",
      "esri/WebScene",
      "esri/portal/PortalItem",
      "esri/portal/Portal",
      "esri/widgets/TimeSlider",
      "esri/widgets/Legend",
      "esri/widgets/LayerList",
      "esri/widgets/Fullscreen",
      "esri/rest/geometryService",
      "esri/rest/support/Query",
      "esri/rest/support/StatisticDefinition",
      "esri/symbols/WebStyleSymbol",
      "esri/TimeExtent",
      "esri/widgets/Expand",
      "esri/widgets/Editor",
      "esri/renderers/UniqueValueRenderer",
      "esri/widgets/support/DatePicker",
      "esri/widgets/FeatureTable",
      "esri/widgets/Compass",
      "esri/layers/ElevationLayer",
      "esri/Ground",
      "esri/layers/BuildingSceneLayer",
      "esri/widgets/BuildingExplorer",
      "esri/widgets/Slice",
      "esri/analysis/SlicePlane",
      "esri/renderers/SimpleRenderer",
      "esri/symbols/MeshSymbol3D",
      "esri/symbols/edges/SolidEdges3D",
      "esri/layers/GroupLayer"],
      function (Basemap, Map, MapView, SceneView,
        FeatureLayer, FeatureFilter,
        SceneLayer, Layer, TileLayer, VectorTileLayer,
        LabelClass, LabelSymbol3D, WebMap,
        WebScene, PortalItem, Portal,
        TimeSlider, Legend, LayerList, Fullscreen,
        geometryService, Query,
        StatisticDefinition, WebStyleSymbol,
        TimeExtent, Expand, Editor, UniqueValueRenderer, DatePicker,
        FeatureTable, Compass, ElevationLayer, Ground,
        BuildingSceneLayer, BuildingExplorer, Slice, SlicePlane,
        SimpleRenderer, MeshSymbol3D, SolidEdges3D, GroupLayer) {


        // Create Map
        var map = new Map({
          basemap: "dark-gray-vector",
          ground: "world-elevation"
        });

        // Create the SceneView
        var view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [4.479686585031793, 51.9071412859027, 200],
            tilt: 60,

          }
        });

        // Create BuildingSceneLayer and add to the map
        var buildingLayer = new BuildingSceneLayer({
          portalItem: {
            id: "1112e61b52b34fda88bfc6f4279435cc"
          },
          //outFields: ["*"],
          title: "De Zalmhaven Midrise"
        });
        map.add(buildingLayer);


        //Discipline: Architectural
        var columnsLayer = null;
        var slabsLayer = null;
        var wallsLayer = null;

        //Discipline: Structural
        var beamsLayer = null;
        var stFoundationLayer = null;

        buildingLayer.when(() => {
          buildingLayer.allSublayers.forEach((layer) => {
            switch (layer.modelName) {
              case "FullModel":
                layer.visible = true;
                break;

              //case "GenericModel":
              //case "OpeningElement":
              //layer.visible = false;
              //break;

              case "Columns":
                columnsLayer = layer;
                break;

              case "Slabs":
                slabsLayer = layer;
                break;

              case "Walls":
                wallsLayer = layer;
                break;

              case "Beams":
                beamsLayer = layer;
                break;

              case "StructuralFoundation":
                stFoundationLayer = layer;
                break;

              default:
                layer.visible = true;
            }
          });
        });


        //Remove deafult widgets on the left
        view.ui.empty("top-left");


        //Adding building explorer
        const buildingExplorer = new BuildingExplorer({
          view: view,
          layers: [buildingLayer]
        });
        view.ui.add(buildingExplorer, "bottom-right");

        // only display the building levels filter
        buildingExplorer.visibleElements = {
          phases: false,
          disciplines: true
        };

        // Adding OpenStreetMap 3D Buildings
        // Defining the osm 3D building symbol
        let osmSymbol = {
          type: "mesh-3d",
          symbolLayers: [
            {
              type: "fill",
              material: {
                color: [74, 80, 87, 0.5],
                colorMixMode: "replace"
              },
              edges: {
                type: "solid", // autocasts as new SolidEdges3D()
                color: [225, 225, 225, 0.3]
              }
            }
          ]
        };

        //Add the Open Street map with symbol "osmSymbol"
        var osm3D = new SceneLayer({
          portalItem: {
            id: "ca0470dbbddb4db28bad74ed39949e25"
          },
          title: "OpenStreetMap 3D Buildings"
        });
        map.add(osm3D);
        osm3D.renderer = {
          type: "simple",
          symbol: osmSymbol
        }

        //Adding LayerList with OSM 3D building being off
        var LayerList = new LayerList({
          view: view,
          listItemCreatedFunction: function(event){
            const item = event.item;
            if (item.title === "OpenStreetMap 3D Buildings"){
              item.visible = false
            }
          }
        });

        var layerListExpand = new Expand ({
          view: view,
          content: LayerList,
          expandIconClass: "esri-icon-visible",
          group: "top-right"
        });

        view.ui.add(layerListExpand,"top-right");

      });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>